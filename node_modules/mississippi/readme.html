<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>readme</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="mississippi">mississippi</h1>
<p>a collection of useful stream utility modules. learn how the modules work using this and then pick the ones you want and use them individually</p>
<p>the goal of the modules included in mississippi is to make working with streams easy without sacrificing speed, error handling or composability.</p>
<h2 id="usage">usage</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">var</span> miss <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;mississippi&#39;</span>)</a></code></pre></div>
<h2 id="methods">methods</h2>
<ul>
<li><a href="#pipe">pipe</a></li>
<li><a href="#each">each</a></li>
<li><a href="#pipeline">pipeline</a></li>
<li><a href="#duplex">duplex</a></li>
<li><a href="#through">through</a></li>
<li><a href="#from">from</a></li>
<li><a href="#to">to</a></li>
<li><a href="#concat">concat</a></li>
<li><a href="#finished">finished</a></li>
<li><a href="#parallel">parallel</a></li>
</ul>
<h3 id="pipe">pipe</h3>
<h5 id="miss.pipestream1-stream2-stream3-...-cb"><code>miss.pipe(stream1, stream2, stream3, ..., cb)</code></h5>
<p>Pipes streams together and destroys all of them if one of them closes. Calls <code>cb</code> with <code>(error)</code> if there was an error in any of the streams.</p>
<p>When using standard <code>source.pipe(destination)</code> the source will <em>not</em> be destroyed if the destination emits close or error. You are also not able to provide a callback to tell when the pipe has finished.</p>
<p><code>miss.pipe</code> does these two things for you, ensuring you handle stream errors 100% of the time (unhandled errors are probably the most common bug in most node streams code)</p>
<h4 id="original-module">original module</h4>
<p><code>miss.pipe</code> is provided by <a href="https://www.npmjs.com/package/pump"><code>require('pump')</code></a></p>
<h4 id="example">example</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// lets do a simple file copy</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">var</span> read <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./original.zip&#39;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">var</span> write <span class="op">=</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="st">&#39;./copy.zip&#39;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">// use miss.pipe instead of read.pipe(write)</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="va">miss</span>.<span class="at">pipe</span>(read<span class="op">,</span> write<span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="cf">if</span> (err) <span class="cf">return</span> <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Copy error!&#39;</span><span class="op">,</span> err)</a>
<a class="sourceLine" id="cb2-10" title="10">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Copied successfully&#39;</span>)</a>
<a class="sourceLine" id="cb2-11" title="11"><span class="op">}</span>)</a></code></pre></div>
<h3 id="each">each</h3>
<h5 id="miss.eachstream-each-done"><code>miss.each(stream, each, [done])</code></h5>
<p>Iterate the data in <code>stream</code> one chunk at a time. Your <code>each</code> function will be called with <code>(data, next)</code> where data is a data chunk and next is a callback. Call <code>next</code> when you are ready to consume the next chunk.</p>
<p>Optionally you can call <code>next</code> with an error to destroy the stream. You can also pass the optional third argument, <code>done</code>, which is a function that will be called with <code>(err)</code> when the stream ends. The <code>err</code> argument will be populated with an error if the stream emitted an error.</p>
<h4 id="original-module-1">original module</h4>
<p><code>miss.each</code> is provided by <a href="https://www.npmjs.com/package/stream-each"><code>require('stream-each')</code></a></p>
<h4 id="example-1">example</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">var</span> split <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;split2&#39;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">var</span> newLineSeparatedNumbers <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;numbers.txt&#39;</span>)</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">var</span> pipeline <span class="op">=</span> <span class="va">miss</span>.<span class="at">pipeline</span>(newLineSeparatedNumbers<span class="op">,</span> <span class="at">split</span>())</a>
<a class="sourceLine" id="cb3-7" title="7"><span class="va">miss</span>.<span class="at">each</span>(pipeline<span class="op">,</span> eachLine<span class="op">,</span> done)</a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">var</span> sum <span class="op">=</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="kw">function</span> <span class="at">eachLine</span> (line<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">  sum <span class="op">+=</span> <span class="at">parseInt</span>(<span class="va">line</span>.<span class="at">toString</span>())</a>
<a class="sourceLine" id="cb3-12" title="12">  <span class="at">next</span>()</a>
<a class="sourceLine" id="cb3-13" title="13"><span class="op">}</span></a>
<a class="sourceLine" id="cb3-14" title="14"></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="kw">function</span> <span class="at">done</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="cf">if</span> (err) <span class="cf">throw</span> err</a>
<a class="sourceLine" id="cb3-17" title="17">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;sum is&#39;</span><span class="op">,</span> sum)</a>
<a class="sourceLine" id="cb3-18" title="18"><span class="op">}</span></a></code></pre></div>
<h3 id="pipeline">pipeline</h3>
<h5 id="var-pipeline-miss.pipelinestream1-stream2-stream3-..."><code>var pipeline = miss.pipeline(stream1, stream2, stream3, ...)</code></h5>
<p>Builds a pipeline from all the transform streams passed in as arguments by piping them together and returning a single stream object that lets you write to the first stream and read from the last stream.</p>
<p>If you are pumping object streams together use <code>pipeline = miss.pipeline.obj(s1, s2, ...)</code>.</p>
<p>If any of the streams in the pipeline emits an error or gets destroyed, or you destroy the stream it returns, all of the streams will be destroyed and cleaned up for you.</p>
<h4 id="original-module-2">original module</h4>
<p><code>miss.pipeline</code> is provided by <a href="https://www.npmjs.com/package/pumpify"><code>require('pumpify')</code></a></p>
<h4 id="example-2">example</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// first create some transform streams (note: these two modules are fictional)</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">var</span> imageResize <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;image-resizer-stream&#39;</span>)(<span class="op">{</span><span class="dt">width</span><span class="op">:</span> <span class="dv">400</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">var</span> pngOptimizer <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;png-optimizer-stream&#39;</span>)(<span class="op">{</span><span class="dt">quality</span><span class="op">:</span> <span class="dv">60</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">// instead of doing a.pipe(b), use pipelin</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="kw">var</span> resizeAndOptimize <span class="op">=</span> <span class="va">miss</span>.<span class="at">pipeline</span>(imageResize<span class="op">,</span> pngOptimizer)</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">// `resizeAndOptimize` is a transform stream. when you write to it, it writes</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">// to `imageResize`. when you read from it, it reads from `pngOptimizer`.</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">// it handles piping all the streams together for you</span></a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">// use it like any other transform stream</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="kw">var</span> read <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./image.png&#39;</span>)</a>
<a class="sourceLine" id="cb4-15" title="15"><span class="kw">var</span> write <span class="op">=</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="st">&#39;./resized-and-optimized.png&#39;</span>)</a>
<a class="sourceLine" id="cb4-16" title="16"></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="va">miss</span>.<span class="at">pipe</span>(read<span class="op">,</span> resizeAndOptimize<span class="op">,</span> write<span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-18" title="18">  <span class="cf">if</span> (err) <span class="cf">return</span> <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Image processing error!&#39;</span><span class="op">,</span> err)</a>
<a class="sourceLine" id="cb4-19" title="19">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Image processed successfully&#39;</span>)</a>
<a class="sourceLine" id="cb4-20" title="20"><span class="op">}</span>)</a></code></pre></div>
<h3 id="duplex">duplex</h3>
<h5 id="var-duplex-miss.duplexwritable-readable-opts"><code>var duplex = miss.duplex([writable, readable, opts])</code></h5>
<p>Take two separate streams, a writable and a readable, and turn them into a single <a href="https://nodejs.org/api/stream.html#stream_class_stream_duplex">duplex (readable and writable) stream</a>.</p>
<p>The returned stream will emit data from the readable. When you write to it it writes to the writable.</p>
<p>You can either choose to supply the writable and the readable at the time you create the stream, or you can do it later using the <code>.setWritable</code> and <code>.setReadable</code> methods and data written to the stream in the meantime will be buffered for you.</p>
<h4 id="original-module-3">original module</h4>
<p><code>miss.duplex</code> is provided by <a href="https://www.npmjs.com/package/duplexify"><code>require('duplexify')</code></a></p>
<h4 id="example-3">example</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// lets spawn a process and take its stdout and stdin and combine them into 1 stream</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">var</span> child <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;child_process&#39;</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">// @- tells it to read from stdin, --data-binary sets &#39;raw&#39; binary mode</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">var</span> curl <span class="op">=</span> <span class="va">child</span>.<span class="at">spawn</span>(<span class="st">&#39;curl -X POST --data-binary @- http://foo.com&#39;</span>)</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">// duplexCurl will write to stdin and read from stdout</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="kw">var</span> duplexCurl <span class="op">=</span> <span class="va">miss</span>.<span class="at">duplex</span>(<span class="va">curl</span>.<span class="at">stdin</span><span class="op">,</span> <span class="va">curl</span>.<span class="at">stdout</span>)</a></code></pre></div>
<h3 id="through">through</h3>
<h5 id="var-transformer-miss.throughoptions-transformfunction-flushfunction"><code>var transformer = miss.through([options, transformFunction, flushFunction])</code></h5>
<p>Make a custom <a href="https://nodejs.org/docs/latest/api/stream.html#stream_class_stream_transform">transform stream</a>.</p>
<p>The <code>options</code> object is passed to the internal transform stream and can be used to create an <code>objectMode</code> stream (or use the shortcut <code>miss.through.obj([...])</code>)</p>
<p>The <code>transformFunction</code> is called when data is available for the writable side and has the signature <code>(chunk, encoding, cb)</code>. Within the function, add data to the readable side any number of times with <code>this.push(data)</code>. Call <code>cb()</code> to indicate processing of the <code>chunk</code> is complete. Or to easily emit a single error or chunk, call <code>cb(err, chunk)</code></p>
<p>The <code>flushFunction</code>, with signature <code>(cb)</code>, is called just before the stream is complete and should be used to wrap up stream processing.</p>
<h4 id="original-module-4">original module</h4>
<p><code>miss.through</code> is provided by <a href="https://www.npmjs.com/package/through2"><code>require('through2')</code></a></p>
<h4 id="example-4">example</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">var</span> read <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./boring_lowercase.txt&#39;</span>)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">var</span> write <span class="op">=</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="st">&#39;./AWESOMECASE.TXT&#39;</span>)</a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">// Leaving out the options object</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">var</span> uppercaser <span class="op">=</span> <span class="va">miss</span>.<span class="at">through</span>(</a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="kw">function</span> (chunk<span class="op">,</span> enc<span class="op">,</span> cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="va">chunk</span>.<span class="at">toString</span>().<span class="at">toUpperCase</span>())</a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="op">},</span></a>
<a class="sourceLine" id="cb6-11" title="11">  <span class="kw">function</span> (cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="st">&#39;ONE LAST BIT OF UPPERCASE&#39;</span>)</a>
<a class="sourceLine" id="cb6-13" title="13">  <span class="op">}</span></a>
<a class="sourceLine" id="cb6-14" title="14">)</a>
<a class="sourceLine" id="cb6-15" title="15"></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="va">miss</span>.<span class="at">pipe</span>(read<span class="op">,</span> uppercaser<span class="op">,</span> write<span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-17" title="17">  <span class="cf">if</span> (err) <span class="cf">return</span> <span class="va">console</span>.<span class="at">error</span>(<span class="st">&#39;Trouble uppercasing!&#39;</span>)</a>
<a class="sourceLine" id="cb6-18" title="18">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Splendid uppercasing!&#39;</span>)</a>
<a class="sourceLine" id="cb6-19" title="19"><span class="op">}</span>)</a></code></pre></div>
<h3 id="from">from</h3>
<h5 id="miss.fromopts-read"><code>miss.from([opts], read)</code></h5>
<p>Make a custom <a href="https://nodejs.org/docs/latest/api/stream.html#stream_class_stream_readable">readable stream</a>.</p>
<p><code>opts</code> contains the options to pass on to the ReadableStream constructor e.g. for creating a readable object stream (or use the shortcut <code>miss.from.obj([...])</code>).</p>
<p>Returns a readable stream that calls <code>read(size, next)</code> when data is requested from the stream.</p>
<ul>
<li><code>size</code> is the recommended amount of data (in bytes) to retrieve.</li>
<li><code>next(err, chunk)</code> should be called when you’re ready to emit more data.</li>
</ul>
<h4 id="original-module-5">original module</h4>
<p><code>miss.from</code> is provided by <a href="https://www.npmjs.com/package/from2"><code>require('from2')</code></a></p>
<h4 id="example-5">example</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">function</span> <span class="at">fromString</span>(string) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="cf">return</span> <span class="va">miss</span>.<span class="at">from</span>(<span class="kw">function</span>(size<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="co">// if there&#39;s no more content</span></a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="co">// left in the string, close the stream.</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="cf">if</span> (<span class="va">string</span>.<span class="at">length</span> <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="cf">return</span> <span class="at">next</span>(<span class="kw">null</span><span class="op">,</span> <span class="kw">null</span>)</a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="co">// Pull in a new chunk of text,</span></a>
<a class="sourceLine" id="cb7-10" title="10">    <span class="co">// removing it from the string.</span></a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="kw">var</span> chunk <span class="op">=</span> <span class="va">string</span>.<span class="at">slice</span>(<span class="dv">0</span><span class="op">,</span> size)</a>
<a class="sourceLine" id="cb7-12" title="12">    string <span class="op">=</span> <span class="va">string</span>.<span class="at">slice</span>(size)</a>
<a class="sourceLine" id="cb7-13" title="13"></a>
<a class="sourceLine" id="cb7-14" title="14">    <span class="co">// Emit &quot;chunk&quot; from the stream.</span></a>
<a class="sourceLine" id="cb7-15" title="15">    <span class="at">next</span>(<span class="kw">null</span><span class="op">,</span> chunk)</a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-17" title="17"><span class="op">}</span></a>
<a class="sourceLine" id="cb7-18" title="18"></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">// pipe &quot;hello world&quot; out</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">// to stdout.</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="at">fromString</span>(<span class="st">&#39;hello world&#39;</span>).<span class="at">pipe</span>(<span class="va">process</span>.<span class="at">stdout</span>)</a></code></pre></div>
<h3 id="to">to</h3>
<h5 id="miss.tooptions-write-flush"><code>miss.to([options], write, [flush])</code></h5>
<p>Make a custom <a href="https://nodejs.org/docs/latest/api/stream.html#stream_class_stream_writable">writable stream</a>.</p>
<p><code>opts</code> contains the options to pass on to the WritableStream constructor e.g. for creating a writable object stream (or use the shortcut <code>miss.to.obj([...])</code>).</p>
<p>Returns a writable stream that calls <code>write(data, enc, cb)</code> when data is written to the stream.</p>
<ul>
<li><code>data</code> is the received data to write the destination.</li>
<li><code>enc</code> encoding of the piece of data received.</li>
<li><code>cb(err, data)</code> should be called when you’re ready to write more data, or encountered an error.</li>
</ul>
<p><code>flush(cb)</code> is called before <code>finish</code> is emitted and allows for cleanup steps to occur.</p>
<h4 id="original-module-6">original module</h4>
<p><code>miss.to</code> is provided by <a href="https://www.npmjs.com/package/flush-write-stream"><code>require('flush-write-stream')</code></a></p>
<h4 id="example-6">example</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">var</span> ws <span class="op">=</span> <span class="va">miss</span>.<span class="at">to</span>(write<span class="op">,</span> flush)</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="va">ws</span>.<span class="at">on</span>(<span class="st">&#39;finish&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;finished&#39;</span>)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="va">ws</span>.<span class="at">write</span>(<span class="st">&#39;hello&#39;</span>)</a>
<a class="sourceLine" id="cb8-8" title="8"><span class="va">ws</span>.<span class="at">write</span>(<span class="st">&#39;world&#39;</span>)</a>
<a class="sourceLine" id="cb8-9" title="9"><span class="va">ws</span>.<span class="at">end</span>()</a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="kw">function</span> <span class="at">write</span> (data<span class="op">,</span> enc<span class="op">,</span> cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="co">// i am your normal ._write method</span></a>
<a class="sourceLine" id="cb8-13" title="13">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;writing&#39;</span><span class="op">,</span> <span class="va">data</span>.<span class="at">toString</span>())</a>
<a class="sourceLine" id="cb8-14" title="14">  <span class="at">cb</span>()</a>
<a class="sourceLine" id="cb8-15" title="15"><span class="op">}</span></a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="kw">function</span> <span class="at">flush</span> (cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="co">// i am called before finish is emitted</span></a>
<a class="sourceLine" id="cb8-19" title="19">  <span class="at">setTimeout</span>(cb<span class="op">,</span> <span class="dv">1000</span>) <span class="co">// wait 1 sec</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="op">}</span></a></code></pre></div>
<p>If you run the above it will produce the following output</p>
<pre><code>writing hello
writing world
(nothing happens for 1 sec)
finished</code></pre>
<h3 id="concat">concat</h3>
<h5 id="var-concat-miss.concatcb"><code>var concat = miss.concat(cb)</code></h5>
<p>Returns a writable stream that concatenates all data written to the stream and calls a callback with the single result.</p>
<p>Calling <code>miss.concat(cb)</code> returns a writable stream. <code>cb</code> is called when the writable stream is finished, e.g. when all data is done being written to it. <code>cb</code> is called with a single argument, <code>(data)</code>, which will contain the result of concatenating all the data written to the stream.</p>
<p>Note that <code>miss.concat</code> will not handle stream errors for you. To handle errors, use <code>miss.pipe</code> or handle the <code>error</code> event manually.</p>
<h4 id="original-module-7">original module</h4>
<p><code>miss.concat</code> is provided by <a href="https://www.npmjs.com/package/concat-stream"><code>require('concat-stream')</code></a></p>
<h4 id="example-7">example</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">var</span> fs <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;fs&#39;</span>)</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">var</span> readStream <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;cat.png&#39;</span>)</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">var</span> concatStream <span class="op">=</span> <span class="va">miss</span>.<span class="at">concat</span>(gotPicture)</a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">function</span> <span class="at">callback</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="cf">if</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="va">console</span>.<span class="at">error</span>(err)</a>
<a class="sourceLine" id="cb10-9" title="9">    <span class="va">process</span>.<span class="at">exit</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-12" title="12"></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="va">miss</span>.<span class="at">pipe</span>(readStream<span class="op">,</span> concatStream<span class="op">,</span> callback)</a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="kw">function</span> <span class="at">gotPicture</span>(imageBuffer) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-16" title="16">  <span class="co">// imageBuffer is all of `cat.png` as a node.js Buffer</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="op">}</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="kw">function</span> <span class="at">handleError</span>(err) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-20" title="20">  <span class="co">// handle your error appropriately here, e.g.:</span></a>
<a class="sourceLine" id="cb10-21" title="21">  <span class="va">console</span>.<span class="at">error</span>(err) <span class="co">// print the error to STDERR</span></a>
<a class="sourceLine" id="cb10-22" title="22">  <span class="va">process</span>.<span class="at">exit</span>(<span class="dv">1</span>) <span class="co">// exit program with non-zero exit code</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="op">}</span></a></code></pre></div>
<h3 id="finished">finished</h3>
<h5 id="miss.finishedstream-cb"><code>miss.finished(stream, cb)</code></h5>
<p>Waits for <code>stream</code> to finish or error and then calls <code>cb</code> with <code>(err)</code>. <code>cb</code> will only be called once. <code>err</code> will be null if the stream finished without error, or else it will be populated with the error from the streams <code>error</code> event.</p>
<p>This function is useful for simplifying stream handling code as it lets you handle success or error conditions in a single code path. It’s used internally <code>miss.pipe</code>.</p>
<h4 id="original-module-8">original module</h4>
<p><code>miss.finished</code> is provided by <a href="https://www.npmjs.com/package/end-of-stream"><code>require('end-of-stream')</code></a></p>
<h4 id="example-8">example</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">var</span> copySource <span class="op">=</span> <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./movie.mp4&#39;</span>)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">var</span> copyDest <span class="op">=</span> <span class="va">fs</span>.<span class="at">createWriteStream</span>(<span class="st">&#39;./movie-copy.mp4&#39;</span>)</a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="va">copySource</span>.<span class="at">pipe</span>(copyDest)</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="va">miss</span>.<span class="at">finished</span>(copyDest<span class="op">,</span> <span class="kw">function</span>(err) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="cf">if</span> (err) <span class="cf">return</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;write failed&#39;</span><span class="op">,</span> err)</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;write success&#39;</span>)</a>
<a class="sourceLine" id="cb11-9" title="9"><span class="op">}</span>)</a></code></pre></div>
<h3 id="parallel">parallel</h3>
<h5 id="miss.parallelconcurrency-each"><code>miss.parallel(concurrency, each)</code></h5>
<p>This works like <code>through</code> except you can process items in parallel, while still preserving the original input order.</p>
<p>This is handy if you wanna take advantage of node’s async I/O and process streams of items in batches. With this module you can build your very own streaming parallel job queue.</p>
<p>Note that <code>miss.parallel</code> preserves input ordering, if you don’t need that then you can use <a href="https://github.com/almost/through2-concurrent">through2-concurrent</a> instead, which is very similar to this otherwise.</p>
<h4 id="original-module-9">original module</h4>
<p><code>miss.parallel</code> is provided by <a href="https://npmjs.org/parallel-transform"><code>require('parallel-transform')</code></a></p>
<h4 id="example-9">example</h4>
<p>This example fetches the GET HTTP headers for a stream of input URLs 5 at a time in parallel.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">function</span> <span class="at">getResponse</span> (item<span class="op">,</span> cb) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">var</span> r <span class="op">=</span> <span class="at">request</span>(<span class="va">item</span>.<span class="at">url</span>)</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="va">r</span>.<span class="at">on</span>(<span class="st">&#39;error&#39;</span><span class="op">,</span> <span class="kw">function</span> (err) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="at">cb</span>(err)</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="va">r</span>.<span class="at">on</span>(<span class="st">&#39;response&#39;</span><span class="op">,</span> <span class="kw">function</span> (re) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-7" title="7">    <span class="at">cb</span>(<span class="kw">null</span><span class="op">,</span> <span class="op">{</span><span class="dt">url</span><span class="op">:</span> <span class="va">item</span>.<span class="at">url</span><span class="op">,</span> <span class="dt">date</span><span class="op">:</span> <span class="kw">new</span> <span class="at">Date</span>()<span class="op">,</span> <span class="dt">status</span><span class="op">:</span> <span class="va">re</span>.<span class="at">statusCode</span><span class="op">,</span> <span class="dt">headers</span><span class="op">:</span> <span class="va">re</span>.<span class="at">headers</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="va">r</span>.<span class="at">abort</span>()</a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="op">}</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="va">miss</span>.<span class="at">pipe</span>(</a>
<a class="sourceLine" id="cb12-13" title="13">  <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./urls.txt&#39;</span>)<span class="op">,</span> <span class="co">// one url per line</span></a>
<a class="sourceLine" id="cb12-14" title="14">  <span class="at">split</span>()<span class="op">,</span></a>
<a class="sourceLine" id="cb12-15" title="15">  <span class="va">miss</span>.<span class="at">parallel</span>(<span class="dv">5</span><span class="op">,</span> getResponse)<span class="op">,</span></a>
<a class="sourceLine" id="cb12-16" title="16">  <span class="va">miss</span>.<span class="at">through</span>(<span class="kw">function</span> (row<span class="op">,</span> enc<span class="op">,</span> next) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-17" title="17">    <span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(row))</a>
<a class="sourceLine" id="cb12-18" title="18">    <span class="at">next</span>()</a>
<a class="sourceLine" id="cb12-19" title="19">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb12-20" title="20">)</a></code></pre></div>
<h2 id="see-also">see also</h2>
<ul>
<li><a href="https://github.com/substack/stream-handbook">substack/stream-handbook</a></li>
<li><a href="https://nodejs.org/api/stream.html">nodejs.org/api/stream.html</a></li>
<li><a href="https://github.com/thejmazz/awesome-nodejs-streams">awesome-nodejs-streams</a></li>
</ul>
<h2 id="license">license</h2>
<p>Licensed under the BSD 2-clause license.</p>
</body>
</html>
