<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="ssri-npm-version-license-travis-appveyor-coverage-status">ssri <a href="https://npm.im/ssri"><img src="https://img.shields.io/npm/v/ssri.svg" alt="npm version" /></a> <a href="https://npm.im/ssri"><img src="https://img.shields.io/npm/l/ssri.svg" alt="license" /></a> <a href="https://travis-ci.org/zkat/ssri"><img src="https://img.shields.io/travis/zkat/ssri.svg" alt="Travis" /></a> <a href="https://ci.appveyor.com/project/zkat/ssri"><img src="https://ci.appveyor.com/api/projects/status/github/zkat/ssri?svg=true" alt="AppVeyor" /></a> <a href="https://coveralls.io/github/zkat/ssri?branch=latest"><img src="https://coveralls.io/repos/github/zkat/ssri/badge.svg?branch=latest" alt="Coverage Status" /></a></h1>
<p><a href="https://github.com/zkat/ssri"><code>ssri</code></a>, short for Standard Subresource Integrity, is a Node.js utility for parsing, manipulating, serializing, generating, and verifying <a href="https://w3c.github.io/webappsec/specs/subresourceintegrity/">Subresource Integrity</a> hashes.</p>
<h2 id="install">Install</h2>
<p><code>$ npm install --save ssri</code></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#example">Example</a></li>
<li><a href="#features">Features</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#api">API</a>
<ul>
<li>Parsing &amp; Serializing
<ul>
<li><a href="#parse"><code>parse</code></a></li>
<li><a href="#stringify"><code>stringify</code></a></li>
<li><a href="#integrity-concat"><code>Integrity#concat</code></a></li>
<li><a href="#integrity-to-string"><code>Integrity#toString</code></a></li>
<li><a href="#integrity-to-json"><code>Integrity#toJSON</code></a></li>
<li><a href="#integrity-match"><code>Integrity#match</code></a></li>
<li><a href="#integrity-pick-algorithm"><code>Integrity#pickAlgorithm</code></a></li>
<li><a href="#integrity-hex-digest"><code>Integrity#hexDigest</code></a></li>
</ul></li>
<li>Integrity Generation
<ul>
<li><a href="#from-hex"><code>fromHex</code></a></li>
<li><a href="#from-data"><code>fromData</code></a></li>
<li><a href="#from-stream"><code>fromStream</code></a></li>
<li><a href="#create"><code>create</code></a></li>
</ul></li>
<li>Integrity Verification
<ul>
<li><a href="#check-data"><code>checkData</code></a></li>
<li><a href="#check-stream"><code>checkStream</code></a></li>
<li><a href="#integrity-stream"><code>integrityStream</code></a></li>
</ul></li>
</ul></li>
</ul>
<h3 id="example">Example</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> ssri <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;ssri&#39;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> integrity <span class="op">=</span> <span class="st">&#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&#39;</span></a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">// Parsing and serializing</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">const</span> parsed <span class="op">=</span> <span class="va">ssri</span>.<span class="at">parse</span>(integrity)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">ssri</span>.<span class="at">stringify</span>(parsed) <span class="co">// === integrity (works on non-Integrity objects)</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="va">parsed</span>.<span class="at">toString</span>() <span class="co">// === integrity</span></a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">// Async stream functions</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="va">ssri</span>.<span class="at">checkStream</span>(<span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./my-file&#39;</span>)<span class="op">,</span> integrity).<span class="at">then</span>(...)</a>
<a class="sourceLine" id="cb1-12" title="12"><span class="va">ssri</span>.<span class="at">fromStream</span>(<span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./my-file&#39;</span>)).<span class="at">then</span>(sri <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-13" title="13">  <span class="va">sri</span>.<span class="at">toString</span>() <span class="op">===</span> integrity</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-15" title="15"><span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;./my-file&#39;</span>).<span class="at">pipe</span>(<span class="va">ssri</span>.<span class="at">createCheckerStream</span>(sri))</a>
<a class="sourceLine" id="cb1-16" title="16"></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">// Sync data functions</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="va">ssri</span>.<span class="at">fromData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;./my-file&#39;</span>)) <span class="co">// === parsed</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="va">ssri</span>.<span class="at">checkData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;./my-file&#39;</span>)<span class="op">,</span> integrity) <span class="co">// =&gt; &#39;sha512&#39;</span></a></code></pre></div>
<h3 id="features">Features</h3>
<ul>
<li>Parses and stringifies SRI strings.</li>
<li>Generates SRI strings from raw data or Streams.</li>
<li>Strict standard compliance.</li>
<li><code>?foo</code> metadata option support.</li>
<li>Multiple entries for the same algorithm.</li>
<li>Object-based integrity hash manipulation.</li>
<li>Small footprint: no dependencies, concise implementation.</li>
<li>Full test coverage.</li>
<li>Customizable algorithm picker.</li>
</ul>
<h3 id="contributing">Contributing</h3>
<p>The ssri team enthusiastically welcomes contributions and project participation! There’s a bunch of things you can do if you want to contribute! The <a href="CONTRIBUTING.md">Contributor Guide</a> has all the information you need for everything from reporting bugs to contributing entire new features. Please don’t hesitate to jump in if you’d like to, or even ask us questions if something isn’t clear.</p>
<h3 id="api">API</h3>
<h4 id="ssri.parsesri-opts---integrity"><a name="parse"></a> <code>&gt; ssri.parse(sri, [opts]) -&gt; Integrity</code></h4>
<p>Parses <code>sri</code> into an <code>Integrity</code> data structure. <code>sri</code> can be an integrity string, an <code>Hash</code>-like with <code>digest</code> and <code>algorithm</code> fields and an optional <code>options</code> field, or an <code>Integrity</code>-like object. The resulting object will be an <code>Integrity</code> instance that has this shape:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="st">&#39;sha1&#39;</span><span class="op">:</span> [<span class="op">{</span><span class="dt">algorithm</span><span class="op">:</span> <span class="st">&#39;sha1&#39;</span><span class="op">,</span> <span class="dt">digest</span><span class="op">:</span> <span class="st">&#39;deadbeef&#39;</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> []<span class="op">}</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="st">&#39;sha512&#39;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="op">{</span><span class="dt">algorithm</span><span class="op">:</span> <span class="st">&#39;sha512&#39;</span><span class="op">,</span> <span class="dt">digest</span><span class="op">:</span> <span class="st">&#39;c0ffee&#39;</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> []<span class="op">},</span></a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="op">{</span><span class="dt">algorithm</span><span class="op">:</span> <span class="st">&#39;sha512&#39;</span><span class="op">,</span> <span class="dt">digest</span><span class="op">:</span> <span class="st">&#39;bad1dea&#39;</span><span class="op">,</span> <span class="dt">options</span><span class="op">:</span> [<span class="st">&#39;foo&#39;</span>]<span class="op">}</span></a>
<a class="sourceLine" id="cb2-6" title="6">  ]<span class="op">,</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>If <code>opts.single</code> is truthy, a single <code>Hash</code> object will be returned. That is, a single object that looks like <code>{algorithm, digest, options}</code>, as opposed to a larger object with multiple of these.</p>
<p>If <code>opts.strict</code> is truthy, the resulting object will be filtered such that it strictly follows the Subresource Integrity spec, throwing away any entries with any invalid components. This also means a restricted set of algorithms will be used – the spec limits them to <code>sha256</code>, <code>sha384</code>, and <code>sha512</code>.</p>
<p>Strict mode is recommended if the integrity strings are intended for use in browsers, or in other situations where strict adherence to the spec is needed.</p>
<h5 id="example-1">Example</h5>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="va">ssri</span>.<span class="at">parse</span>(<span class="st">&#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&#39;</span>) <span class="co">// -&gt; Integrity object</span></a></code></pre></div>
<h4 id="ssri.stringifysri-opts---string"><a name="stringify"></a> <code>&gt; ssri.stringify(sri, [opts]) -&gt; String</code></h4>
<p>This function is identical to <a href="#integrity-to-string"><code>Integrity#toString()</code></a>, except it can be used on <em>any</em> object that <a href="#parse"><code>parse</code></a> can handle – that is, a string, an <code>Hash</code>-like, or an <code>Integrity</code>-like.</p>
<p>The <code>opts.sep</code> option defines the string to use when joining multiple entries together. To be spec-compliant, this <em>must</em> be whitespace. The default is a single space (<code>' '</code>).</p>
<p>If <code>opts.strict</code> is true, the integrity string will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-2">Example</h5>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// Useful for cleaning up input SRI strings:</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">ssri</span>.<span class="at">stringify</span>(<span class="st">&#39;</span><span class="sc">\n\r</span><span class="st">sha512-foo</span><span class="sc">\n\t\t</span><span class="st">sha384-bar&#39;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">// -&gt; &#39;sha512-foo sha384-bar&#39;</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">// Hash-like: only a single entry.</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="va">ssri</span>.<span class="at">stringify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="dt">algorithm</span><span class="op">:</span> <span class="st">&#39;sha512&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="dt">digest</span><span class="op">:</span><span class="st">&#39;9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="dt">options</span><span class="op">:</span> [<span class="st">&#39;foo&#39;</span>]</a>
<a class="sourceLine" id="cb4-10" title="10"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">// -&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">// &#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&#39;</span></a>
<a class="sourceLine" id="cb4-13" title="13"></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">// Integrity-like: full multi-entry syntax. Similar to output of `ssri.parse`</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="va">ssri</span>.<span class="at">stringify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="st">&#39;sha512&#39;</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb4-17" title="17">    <span class="op">{</span></a>
<a class="sourceLine" id="cb4-18" title="18">      <span class="dt">algorithm</span><span class="op">:</span> <span class="st">&#39;sha512&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-19" title="19">      <span class="dt">digest</span><span class="op">:</span><span class="st">&#39;9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-20" title="20">      <span class="dt">options</span><span class="op">:</span> [<span class="st">&#39;foo&#39;</span>]</a>
<a class="sourceLine" id="cb4-21" title="21">    <span class="op">}</span></a>
<a class="sourceLine" id="cb4-22" title="22">  ]</a>
<a class="sourceLine" id="cb4-23" title="23"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">// -&gt;</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">// &#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&#39;</span></a></code></pre></div>
<h4 id="integrityconcatotherintegrity-opts---integrity"><a name="integrity-concat"></a> <code>&gt; Integrity#concat(otherIntegrity, [opts]) -&gt; Integrity</code></h4>
<p>Concatenates an <code>Integrity</code> object with another IntegrityLike, or an integrity string.</p>
<p>This is functionally equivalent to concatenating the string format of both integrity arguments, and calling <a href="#ssri-parse"><code>ssri.parse</code></a> on the new string.</p>
<p>If <code>opts.strict</code> is true, the new <code>Integrity</code> will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-3">Example</h5>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// This will combine the integrity checks for two different versions of</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">// your index.js file so you can use a single integrity string and serve</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">// either of these to clients, from a single `&lt;script&gt;` tag.</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">const</span> desktopIntegrity <span class="op">=</span> <span class="va">ssri</span>.<span class="at">fromData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;./index.desktop.js&#39;</span>))</a>
<a class="sourceLine" id="cb5-5" title="5"><span class="kw">const</span> mobileIntegrity <span class="op">=</span> <span class="va">ssri</span>.<span class="at">fromData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;./index.mobile.js&#39;</span>))</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">// Note that browsers (and ssri) will succeed as long as ONE of the entries</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">// for the *prioritized* algorithm succeeds. That is, in order for this fallback</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">// to work, both desktop and mobile *must* use the same `algorithm` values.</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="va">desktopIntegrity</span>.<span class="at">concat</span>(mobileIntegrity)</a></code></pre></div>
<h4 id="integritytostringopts---string"><a name="integrity-to-string"></a> <code>&gt; Integrity#toString([opts]) -&gt; String</code></h4>
<p>Returns the string representation of an <code>Integrity</code> object. All hash entries will be concatenated in the string by <code>opts.sep</code>, which defaults to <code>' '</code>.</p>
<p>If you want to serialize an object that didn’t come from an <code>ssri</code> function, use <a href="#stringify"><code>ssri.stringify()</code></a>.</p>
<p>If <code>opts.strict</code> is true, the integrity string will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-4">Example</h5>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="st">&#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&#39;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="va">ssri</span>.<span class="at">parse</span>(integrity).<span class="at">toString</span>() <span class="op">===</span> integrity</a></code></pre></div>
<h4 id="integritytojson---string"><a name="integrity-to-json"></a> <code>&gt; Integrity#toJSON() -&gt; String</code></h4>
<p>Returns the string representation of an <code>Integrity</code> object. All hash entries will be concatenated in the string by <code>' '</code>.</p>
<p>This is a convenience method so you can pass an <code>Integrity</code> object directly to <code>JSON.stringify</code>. For more info check out <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#toJSON%28%29_behavior">toJSON() behavior on mdn</a>.</p>
<h5 id="example-5">Example</h5>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="st">&#39;&quot;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==?foo&quot;&#39;</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="va">JSON</span>.<span class="at">stringify</span>(<span class="va">ssri</span>.<span class="at">parse</span>(integrity)) <span class="op">===</span> integrity</a></code></pre></div>
<h4 id="integritymatchsri-opts---hash-false"><a name="integrity-match"></a> <code>&gt; Integrity#match(sri, [opts]) -&gt; Hash | false</code></h4>
<p>Returns the matching (truthy) hash if <code>Integrity</code> matches the argument passed as <code>sri</code>, which can be anything that <a href="#parse"><code>parse</code></a> will accept. <code>opts</code> will be passed through to <code>parse</code> and <a href="#integrity-pick-algorithm"><code>pickAlgorithm()</code></a>.</p>
<h5 id="example-6">Example</h5>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="st">&#39;sha512-9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==&#39;</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="va">ssri</span>.<span class="at">parse</span>(integrity).<span class="at">match</span>(integrity)</a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">// Hash {</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">//   digest: &#39;9KhgCRIx/AmzC8xqYJTZRrnO8OW2Pxyl2DIMZSBOr0oDvtEFyht3xpp71j/r/pAe1DM+JI/A+line3jUBgzQ7A==&#39;</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">//   algorithm: &#39;sha512&#39;</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">// }</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="va">ssri</span>.<span class="at">parse</span>(integrity).<span class="at">match</span>(<span class="st">&#39;sha1-deadbeef&#39;</span>)</a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">// false</span></a></code></pre></div>
<h4 id="integritypickalgorithmopts---string"><a name="integrity-pick-algorithm"></a> <code>&gt; Integrity#pickAlgorithm([opts]) -&gt; String</code></h4>
<p>Returns the “best” algorithm from those available in the integrity object.</p>
<p>If <code>opts.pickAlgorithm</code> is provided, it will be passed two algorithms as arguments. ssri will prioritize whichever of the two algorithms is returned by this function. Note that the function may be called multiple times, and it <strong>must</strong> return one of the two algorithms provided. By default, ssri will make a best-effort to pick the strongest/most reliable of the given algorithms. It may intentionally deprioritize algorithms with known vulnerabilities.</p>
<h5 id="example-7">Example</h5>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">ssri</span>.<span class="at">parse</span>(<span class="st">&#39;sha1-WEakDigEST sha512-yzd8ELD1piyANiWnmdnpCL5F52f10UfUdEkHywVZeqTt0ymgrxR63Qz0GB7TKPoeeZQmWCaz7T1&#39;</span>).<span class="at">pickAlgorithm</span>() <span class="co">// sha512</span></a></code></pre></div>
<h4 id="integrityhexdigest---string"><a name="integrity-hex-digest"></a> <code>&gt; Integrity#hexDigest() -&gt; String</code></h4>
<p><code>Integrity</code> is assumed to be either a single-hash <code>Integrity</code> instance, or a <code>Hash</code> instance. Returns its <code>digest</code>, converted to a hex representation of the base64 data.</p>
<h5 id="example-8">Example</h5>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="va">ssri</span>.<span class="at">parse</span>(<span class="st">&#39;sha1-deadbeef&#39;</span>).<span class="at">hexDigest</span>() <span class="co">// &#39;75e69d6de79f&#39;</span></a></code></pre></div>
<h4 id="ssri.fromhexhexdigest-algorithm-opts---integrity"><a name="from-hex"></a> <code>&gt; ssri.fromHex(hexDigest, algorithm, [opts]) -&gt; Integrity</code></h4>
<p>Creates an <code>Integrity</code> object with a single entry, based on a hex-formatted hash. This is a utility function to help convert existing shasums to the Integrity format, and is roughly equivalent to something like:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1">algorithm <span class="op">+</span> <span class="st">&#39;-&#39;</span> <span class="op">+</span> <span class="va">Buffer</span>.<span class="at">from</span>(hexDigest<span class="op">,</span> <span class="st">&#39;hex&#39;</span>).<span class="at">toString</span>(<span class="st">&#39;base64&#39;</span>)</a></code></pre></div>
<p><code>opts.options</code> may optionally be passed in: it must be an array of option strings that will be added to all generated integrity hashes generated by <code>fromData</code>. This is a loosely-specified feature of SRIs, and currently has no specified semantics besides being <code>?</code>-separated. Use at your own risk, and probably avoid if your integrity strings are meant to be used with browsers.</p>
<p>If <code>opts.strict</code> is true, the integrity object will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<p>If <code>opts.single</code> is true, a single <code>Hash</code> object will be returned.</p>
<h5 id="example-9">Example</h5>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="va">ssri</span>.<span class="at">fromHex</span>(<span class="st">&#39;75e69d6de79f&#39;</span><span class="op">,</span> <span class="st">&#39;sha1&#39;</span>).<span class="at">toString</span>() <span class="co">// &#39;sha1-deadbeef&#39;</span></a></code></pre></div>
<h4 id="ssri.fromdatadata-opts---integrity"><a name="from-data"></a> <code>&gt; ssri.fromData(data, [opts]) -&gt; Integrity</code></h4>
<p>Creates an <code>Integrity</code> object from either string or <code>Buffer</code> data, calculating all the requested hashes and adding any specified options to the object.</p>
<p><code>opts.algorithms</code> determines which algorithms to generate hashes for. All results will be included in a single <code>Integrity</code> object. The default value for <code>opts.algorithms</code> is <code>['sha512']</code>. All algorithm strings must be hashes listed in <code>crypto.getHashes()</code> for the host Node.js platform.</p>
<p><code>opts.options</code> may optionally be passed in: it must be an array of option strings that will be added to all generated integrity hashes generated by <code>fromData</code>. This is a loosely-specified feature of SRIs, and currently has no specified semantics besides being <code>?</code>-separated. Use at your own risk, and probably avoid if your integrity strings are meant to be used with browsers.</p>
<p>If <code>opts.strict</code> is true, the integrity object will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-10">Example</h5>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">const</span> integrityObj <span class="op">=</span> <span class="va">ssri</span>.<span class="at">fromData</span>(<span class="st">&#39;foobarbaz&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="dt">algorithms</span><span class="op">:</span> [<span class="st">&#39;sha256&#39;</span><span class="op">,</span> <span class="st">&#39;sha384&#39;</span><span class="op">,</span> <span class="st">&#39;sha512&#39;</span>]</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="va">integrity</span>.<span class="at">toString</span>(<span class="st">&#39;</span><span class="sc">\n</span><span class="st">&#39;</span>)</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">// -&gt;</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">// sha256-l981iLWj8kurw4UbNy8Lpxqdzd7UOxS50Glhv8FwfZ0=</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">// sha384-irnCxQ0CfQhYGlVAUdwTPC9bF3+YWLxlaDGM4xbYminxpbXEq+D+2GCEBTxcjES9</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">// sha512-yzd8ELD1piyANiWnmdnpCL5F52f10UfUdEkHywVZeqTt0ymgrxR63Qz0GB7TKPoeeZQmWCaz7T1+9vBnypkYWg==</span></a></code></pre></div>
<h4 id="ssri.fromstreamstream-opts---promiseintegrity"><a name="from-stream"></a> <code>&gt; ssri.fromStream(stream, [opts]) -&gt; Promise&lt;Integrity&gt;</code></h4>
<p>Returns a Promise of an Integrity object calculated by reading data from a given <code>stream</code>.</p>
<p>It accepts both <code>opts.algorithms</code> and <code>opts.options</code>, which are documented as part of <a href="#from-data"><code>ssri.fromData</code></a>.</p>
<p>Additionally, <code>opts.Promise</code> may be passed in to inject a Promise library of choice. By default, ssri will use Node’s built-in Promises.</p>
<p>If <code>opts.strict</code> is true, the integrity object will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-11">Example</h5>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="va">ssri</span>.<span class="at">fromStream</span>(<span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="dt">algorithms</span><span class="op">:</span> [<span class="st">&#39;sha1&#39;</span><span class="op">,</span> <span class="st">&#39;sha512&#39;</span>]</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="op">}</span>).<span class="at">then</span>(integrity <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-4" title="4">  <span class="cf">return</span> <span class="va">ssri</span>.<span class="at">checkStream</span>(<span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)<span class="op">,</span> integrity)</a>
<a class="sourceLine" id="cb14-5" title="5"><span class="op">}</span>) <span class="co">// succeeds</span></a></code></pre></div>
<h4 id="ssri.createopts---hash"><a name="create"></a> <code>&gt; ssri.create([opts]) -&gt; &lt;Hash&gt;</code></h4>
<p>Returns a Hash object with <code>update(&lt;Buffer or string&gt;[,enc])</code> and <code>digest()</code> methods.</p>
<p>The Hash object provides the same methods as <a href="https://nodejs.org/dist/latest-v6.x/docs/api/crypto.html#crypto_class_hash">crypto class Hash</a>. <code>digest()</code> accepts no arguments and returns an Integrity object calculated by reading data from calls to update.</p>
<p>It accepts both <code>opts.algorithms</code> and <code>opts.options</code>, which are documented as part of <a href="#from-data"><code>ssri.fromData</code></a>.</p>
<p>If <code>opts.strict</code> is true, the integrity object will be created using strict parsing rules. See <a href="#parse"><code>ssri.parse</code></a>.</p>
<h5 id="example-12">Example</h5>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="va">ssri</span>.<span class="at">create</span>().<span class="at">update</span>(<span class="st">&#39;foobarbaz&#39;</span>).<span class="at">digest</span>()</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="va">integrity</span>.<span class="at">toString</span>()</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="co">// -&gt;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="co">// sha512-yzd8ELD1piyANiWnmdnpCL5F52f10UfUdEkHywVZeqTt0ymgrxR63Qz0GB7TKPoeeZQmWCaz7T1+9vBnypkYWg==</span></a></code></pre></div>
<h4 id="ssri.checkdatadata-sri-opts---hashfalse"><a name="check-data"></a> <code>&gt; ssri.checkData(data, sri, [opts]) -&gt; Hash|false</code></h4>
<p>Verifies <code>data</code> integrity against an <code>sri</code> argument. <code>data</code> may be either a <code>String</code> or a <code>Buffer</code>, and <code>sri</code> can be any subresource integrity representation that <a href="#parse"><code>ssri.parse</code></a> can handle.</p>
<p>If verification succeeds, <code>checkData</code> will return the name of the algorithm that was used for verification (a truthy value). Otherwise, it will return <code>false</code>.</p>
<p>If <code>opts.pickAlgorithm</code> is provided, it will be used by <a href="#integrity-pick-algorithm"><code>Integrity#pickAlgorithm</code></a> when deciding which of the available digests to match against.</p>
<p>If <code>opts.error</code> is true, and verification fails, <code>checkData</code> will throw either an <code>EBADSIZE</code> or an <code>EINTEGRITY</code> error, instead of just returning false.</p>
<h5 id="example-13">Example</h5>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> data <span class="op">=</span> <span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;index.js&#39;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="va">ssri</span>.<span class="at">checkData</span>(data<span class="op">,</span> <span class="va">ssri</span>.<span class="at">fromData</span>(data)) <span class="co">// -&gt; &#39;sha512&#39;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="va">ssri</span>.<span class="at">checkData</span>(data<span class="op">,</span> <span class="st">&#39;sha256-l981iLWj8kurw4UbNy8Lpxqdzd7UOxS50Glhv8FwfZ0&#39;</span>)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="va">ssri</span>.<span class="at">checkData</span>(data<span class="op">,</span> <span class="st">&#39;sha1-BaDDigEST&#39;</span>) <span class="co">// -&gt; false</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="va">ssri</span>.<span class="at">checkData</span>(data<span class="op">,</span> <span class="st">&#39;sha1-BaDDigEST&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">error</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>) <span class="co">// -&gt; Error! EINTEGRITY</span></a></code></pre></div>
<h4 id="ssri.checkstreamstream-sri-opts---promisehash"><a name="check-stream"></a> <code>&gt; ssri.checkStream(stream, sri, [opts]) -&gt; Promise&lt;Hash&gt;</code></h4>
<p>Verifies the contents of <code>stream</code> against an <code>sri</code> argument. <code>stream</code> will be consumed in its entirety by this process. <code>sri</code> can be any subresource integrity representation that <a href="#parse"><code>ssri.parse</code></a> can handle.</p>
<p><code>checkStream</code> will return a Promise that either resolves to the <code>Hash</code> that succeeded verification, or, if the verification fails or an error happens with <code>stream</code>, the Promise will be rejected.</p>
<p>If the Promise is rejected because verification failed, the returned error will have <code>err.code</code> as <code>EINTEGRITY</code>.</p>
<p>If <code>opts.size</code> is given, it will be matched against the stream size. An error with <code>err.code</code> <code>EBADSIZE</code> will be returned by a rejection if the expected size and actual size fail to match.</p>
<p>If <code>opts.pickAlgorithm</code> is provided, it will be used by <a href="#integrity-pick-algorithm"><code>Integrity#pickAlgorithm</code></a> when deciding which of the available digests to match against.</p>
<h5 id="example-14">Example</h5>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="va">ssri</span>.<span class="at">fromData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;index.js&#39;</span>))</a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="va">ssri</span>.<span class="at">checkStream</span>(</a>
<a class="sourceLine" id="cb17-4" title="4">  <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb17-5" title="5">  integrity</a>
<a class="sourceLine" id="cb17-6" title="6">)</a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">// -&gt;</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="co">// Promise&lt;{</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">//   algorithm: &#39;sha512&#39;,</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">//   digest: &#39;sha512-yzd8ELD1piyANiWnmdnpCL5F52f10UfUdEkHywVZeqTt0ymgrxR63Qz0GB7TKPoeeZQmWCaz7T1&#39;</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">// }&gt;</span></a>
<a class="sourceLine" id="cb17-12" title="12"></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="va">ssri</span>.<span class="at">checkStream</span>(</a>
<a class="sourceLine" id="cb17-14" title="14">  <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb17-15" title="15">  <span class="st">&#39;sha256-l981iLWj8kurw4UbNy8Lpxqdzd7UOxS50Glhv8FwfZ0&#39;</span></a>
<a class="sourceLine" id="cb17-16" title="16">) <span class="co">// -&gt; Promise&lt;Hash&gt;</span></a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="va">ssri</span>.<span class="at">checkStream</span>(</a>
<a class="sourceLine" id="cb17-19" title="19">  <span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb17-20" title="20">  <span class="st">&#39;sha1-BaDDigEST&#39;</span></a>
<a class="sourceLine" id="cb17-21" title="21">) <span class="co">// -&gt; Promise&lt;Error&lt;{code: &#39;EINTEGRITY&#39;}&gt;&gt;</span></a></code></pre></div>
<h4 id="integritystreamopts---integritystream"><a name="integrity-stream"></a> <code>&gt; integrityStream([opts]) -&gt; IntegrityStream</code></h4>
<p>Returns a <code>Transform</code> stream that data can be piped through in order to generate and optionally check data integrity for piped data. When the stream completes successfully, it emits <code>size</code> and <code>integrity</code> events, containing the total number of bytes processed and a calculated <code>Integrity</code> instance based on stream data, respectively.</p>
<p>If <code>opts.algorithms</code> is passed in, the listed algorithms will be calculated when generating the final <code>Integrity</code> instance. The default is <code>['sha512']</code>.</p>
<p>If <code>opts.single</code> is passed in, a single <code>Hash</code> instance will be returned.</p>
<p>If <code>opts.integrity</code> is passed in, it should be an <code>integrity</code> value understood by <a href="#parse"><code>parse</code></a> that the stream will check the data against. If verification succeeds, the integrity stream will emit a <code>verified</code> event whose value is a single <code>Hash</code> object that is the one that succeeded verification. If verification fails, the stream will error with an <code>EINTEGRITY</code> error code.</p>
<p>If <code>opts.size</code> is given, it will be matched against the stream size. An error with <code>err.code</code> <code>EBADSIZE</code> will be emitted by the stream if the expected size and actual size fail to match.</p>
<p>If <code>opts.pickAlgorithm</code> is provided, it will be passed two algorithms as arguments. ssri will prioritize whichever of the two algorithms is returned by this function. Note that the function may be called multiple times, and it <strong>must</strong> return one of the two algorithms provided. By default, ssri will make a best-effort to pick the strongest/most reliable of the given algorithms. It may intentionally deprioritize algorithms with known vulnerabilities.</p>
<h5 id="example-15">Example</h5>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">const</span> integrity <span class="op">=</span> <span class="va">ssri</span>.<span class="at">fromData</span>(<span class="va">fs</span>.<span class="at">readFileSync</span>(<span class="st">&#39;index.js&#39;</span>))</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="va">fs</span>.<span class="at">createReadStream</span>(<span class="st">&#39;index.js&#39;</span>)</a>
<a class="sourceLine" id="cb18-3" title="3">.<span class="at">pipe</span>(<span class="va">ssri</span>.<span class="at">integrityStream</span>(<span class="op">{</span>integrity<span class="op">}</span>))</a></code></pre></div>
</body>
</html>
